<!DOCTYPE html>
<html data-bs-theme="dark">

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RSS Feed Manager - {{ addon_name }} Stremio Addon</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.css" rel="stylesheet"/>
    <link href="/static/css/styles.css" rel="stylesheet">
    <link href="/static/css/rss-manager.css" rel="stylesheet">
    <link rel="shortcut icon" href="{{ logo_url }}" type="image/x-icon">
</head>

<body>
    <!-- API Password Login Overlay -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-container">
            <div class="login-form-container">
                <img class="logo mb-4" src="{{ logo_url }}">
                <h4 class="text-center mb-4">Admin Authentication Required</h4>
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="apiPassword" class="form-label">API Password</label>
                        <input type="password" class="form-control" id="apiPassword" required>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="rememberPassword" checked>
                        <label class="form-check-label" for="rememberPassword">Remember password</label>
                    </div>
                    <div id="loginError" class="alert alert-danger" style="display: none;"></div>
                    <button type="submit" class="btn btn-primary w-100">Login</button>
                </form>
            </div>
        </div>
    </div>

    <div id="mainContent" style="display: none;" class="container">
        <div class="row justify-content-center">
            <div class="col-md-10 config-container">
                <a href="/"><img class="logo" src="{{ logo_url }}"></a>
                <h3 class="text-center mb-5"><b>RSS Feed Manager</b> - Configure RSS Feeds</h3>

                <!-- Add/Edit RSS Feed Form -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0" id="formTitle">Add RSS Feed</h5>
                        <button type="button" class="btn btn-outline-primary btn-sm" id="toggleFormBtn">
                            <i class="bi bi-chevron-down" id="toggleFormIcon"></i>
                            <span id="toggleFormText">Show Form</span>
                        </button>
                    </div>
                    <div class="card-body" id="rssFormContainer" style="display: none;">
                        <form id="rssForm">
                            <input type="hidden" id="feedId" name="feedId">

                            <!-- Basic Info Section -->
                            <div class="form-section">
                                <h6 class="mb-3">Basic Information</h6>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="feedName" class="form-label">Feed Name</label>
                                        <input type="text" class="form-control" id="feedName" name="feedName" required>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-8">
                                        <label for="feedUrl" class="form-label">Feed URL</label>
                                        <input type="url" class="form-control" id="feedUrl" name="feedUrl" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label d-block">&nbsp;</label>
                                        <button type="button" class="btn btn-secondary w-100" id="testFeedBtn">
                                            <i class="bi bi-lightning-charge-fill me-1"></i> Test Feed
                                        </button>
                                    </div>
                                </div>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="feedActive" name="feedActive" checked>
                                    <label class="form-check-label" for="feedActive">Active</label>
                                </div>
                            </div>

                            <!-- Test Results Card -->
                            <div class="card mb-4" id="testResultsCard" style="display: none;">
                                <div class="card-header">
                                    <h6 class="mb-0">Feed Test Results</h6>
                                </div>
                                <div class="card-body">
                                    <div id="testResults"></div>
                                </div>
                            </div>

                            <!-- Parsing Patterns Section -->
                            <div class="form-section">
                                <h6 class="mb-3">Parsing Patterns</h6>
                                <div class="alert alert-info mb-3">
                                    <h6><i class="bi bi-info-circle-fill"></i> Pattern Syntax Guide</h6>
                                    <p class="mb-2"><strong>Basic paths:</strong> Use dot notation for nested properties (e.g., <code>enclosure.url</code>)</p>
                                    <p class="mb-2"><strong>Array access:</strong> Use <code>$</code> for first array item (e.g., <code>enclosure.$.url</code>)</p>
                                    <p class="mb-2"><strong>Array search:</strong> Find by attribute (e.g., <code>torznab:attr[@name="seeders"]@value</code>)</p>
                                    <p class="mb-0"><strong>Complex example:</strong> <code>torznab:attr[@name="seeders"]@value</code> finds the object in the array where <code>@name</code> equals "seeders" and returns its <code>@value</code></p>
                                </div>

                                <!-- Consolidated Parsing Patterns -->
                                <div class="parsing-patterns-section">
                                    <!-- Basic Information Fields -->
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="patternTitle" class="form-label">Title</label>
                                            <input type="text" class="form-control pattern-input" id="patternTitle" name="title" value="title">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="patternDescription" class="form-label">Description</label>
                                            <input type="text" class="form-control pattern-input" id="patternDescription" name="description" value="description">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="patternPubDate" class="form-label">Publication Date</label>
                                            <input type="text" class="form-control pattern-input" id="patternPubDate" name="pubDate" value="pubDate">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="patternPoster" class="form-label">Poster URL</label>
                                            <input type="text" class="form-control pattern-input" id="patternPoster" name="poster" placeholder="E.g., poster, image, thumbnail">
                                            <small class="text-muted">Movie/series poster image URL</small>
                                            </div>
                                        <div class="col-md-6">
                                            <label for="patternBackground" class="form-label">Background URL</label>
                                            <input type="text" class="form-control pattern-input" id="patternBackground" name="background" placeholder="E.g., backdrop, background">
                                            <small class="text-muted">Background/backdrop image URL</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="patternLogo" class="form-label">Logo URL</label>
                                            <input type="text" class="form-control pattern-input" id="patternLogo" name="logo" placeholder="E.g., logo, brand">
                                            <small class="text-muted">Logo image URL</small>
                                        </div>
                                    </div>

                                    <!-- Category with Regex Option -->
                                    <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="patternCategory" class="form-label">Category</label>
                                                <input type="text" class="form-control pattern-input" id="patternCategory" name="category" value="category">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="patternCategoryRegex" class="form-label">Category Regex (Optional)</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control pattern-input" id="patternCategoryRegex" name="category_regex" placeholder="E.g., Category: ([^,\\n]+)">
                                                <button class="btn btn-outline-secondary regex-test-btn" type="button" data-source="description" data-target="patternCategoryRegex" data-field="category">
                                                    <i class="bi bi-eyeglasses"></i>
                                                </button>
                                            </div>
                                            <small class="text-muted">Extract category from text using regex</small>
                                        </div>
                                    </div>



                                    <!-- Torrent-specific Fields -->
                                    <h6 class="mt-4 mb-3">Torrent Information</h6>

                                    <!-- Magnet Link with Regex Option -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="patternMagnet" class="form-label">Magnet Link</label>
                                            <input type="text" class="form-control pattern-input" id="patternMagnet" name="magnet" placeholder="E.g., guid, link, or enclosure.url">
                                            <small class="text-muted">Often found in guid field for RSS feeds</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="patternMagnetRegex" class="form-label">Magnet Regex (Optional)</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control pattern-input" id="patternMagnetRegex" name="magnet_regex" placeholder="E.g., (magnet:\\?xt=urn:btih:[^&\\s]+)">
                                                <button class="btn btn-outline-secondary regex-test-btn" type="button" data-source="description" data-target="patternMagnetRegex" data-field="magnet">
                                                    <i class="bi bi-eyeglasses"></i>
                                                </button>
                                            </div>
                                            <small class="text-muted">Extract magnet link from text using regex</small>
                                        </div>
                                    </div>

                                    <!-- Torrent Link with Regex Option -->
                                    <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="patternTorrent" class="form-label">Torrent Link</label>
                                                <input type="text" class="form-control pattern-input" id="patternTorrent" name="torrent" placeholder="E.g., link or enclosure.url">
                                            </div>
                                        <div class="col-md-6">
                                            <label for="patternTorrentRegex" class="form-label">Torrent Regex (Optional)</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control pattern-input" id="patternTorrentRegex" name="torrent_regex" placeholder="E.g., (https?://[^\\s]+\\.torrent)">
                                                <button class="btn btn-outline-secondary regex-test-btn" type="button" data-source="description" data-target="patternTorrentRegex" data-field="torrent">
                                                    <i class="bi bi-eyeglasses"></i>
                                                </button>
                                            </div>
                                            <small class="text-muted">Extract torrent link from text using regex</small>
                                        </div>
                                        </div>

                                        <!-- Size with Regex Option -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="patternSize" class="form-label">Size</label>
                                            <input type="text" class="form-control pattern-input" id="patternSize" name="size" placeholder="Size field path or enclosure.@length">
                                            </div>
                                            <div class="col-md-6">
                                            <label for="patternSizeRegex" class="form-label">Size Regex (Optional)</label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control pattern-input" id="patternSizeRegex" name="size_regex" placeholder="E.g., Size: (\d+\.?\d*) GB">
                                                    <button class="btn btn-outline-secondary regex-test-btn" type="button" data-source="description" data-target="patternSizeRegex" data-field="size">
                                                        <i class="bi bi-eyeglasses"></i>
                                                    </button>
                                                </div>
                                            <small class="text-muted">Extract from description with regex if direct path fails</small>
                                            </div>
                                        </div>

                                        <!-- Seeders with Regex Option -->
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="patternSeeders" class="form-label">Seeders</label>
                                            <input type="text" class="form-control pattern-input" id="patternSeeders" name="seeders" placeholder='E.g., torznab:attr[@name="seeders"]@value'>
                                            <small class="text-muted">For complex nested data like torznab attributes</small>
                                            </div>
                                            <div class="col-md-6">
                                            <label for="patternSeedersRegex" class="form-label">Seeders Regex (Optional)</label>
                                                <div class="input-group">
                                                    <input type="text" class="form-control pattern-input" id="patternSeedersRegex" name="seeders_regex" placeholder="E.g., Seeders: (\d+)">
                                                    <button class="btn btn-outline-secondary regex-test-btn" type="button" data-source="description" data-target="patternSeedersRegex" data-field="seeders">
                                                        <i class="bi bi-eyeglasses"></i>
                                                    </button>
                                                </div>
                                            <small class="text-muted">Extract from description with regex if direct path fails</small>
                                            </div>
                                    </div>

                                    <!-- Episode Name Parser -->
                                    <div class="row mb-3">
                                        <div class="col-md-12">
                                            <label for="patternEpisodeNameParser" class="form-label">Episode Name Parser (Optional)</label>
                                            <input type="text" class="form-control pattern-input" id="patternEpisodeNameParser" name="episode_name_parser" placeholder="E.g., Episode\\.(\\d+)\\.(?P<episode_name>.*?)\\.720p">
                                            <small class="text-muted">
                                                Regex pattern to extract episode names from filenames. Use named group "episode_name" or first capture group.
                                                <br><strong>Examples:</strong>
                                                <br>• <code>Episode\\.\\d+\\.(?P&lt;episode_name&gt;.*?)\\.720p</code> - Naruto.Shippuden.Episode.500.The.Message.720p.mp4
                                                <br>• <code>E\\d+\\.(?P&lt;episode_name&gt;.*?)\\.HDTV</code> - Documentary.Series.E03.Climate.Change.Effects.HDTV.mkv
                                                <br>• <code>\\d+\\.(?P&lt;episode_name&gt;.*?)\\.1080p</code> - One.Piece.1089.Luffy.vs.Kaido.Final.Battle.1080p.mkv
                                            </small>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!-- Filtering Options -->
                            <div class="form-section">
                                <h6 class="mb-3">Content Filtering</h6>
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle-fill"></i>
                                    Configure filters to only process items that match specific criteria. Leave empty to process all items.
                                        </div>

                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                        <label for="titleFilter" class="form-label">Title Filter (Regex)</label>
                                        <input type="text" class="form-control" id="titleFilter" name="titleFilter" placeholder="E.g., .*1080p.*|.*720p.*">
                                        <small class="text-muted">Only process items whose title matches this regex pattern</small>
                                            </div>
                                            <div class="col-md-6">
                                        <label for="titleExcludeFilter" class="form-label">Title Exclude Filter (Regex)</label>
                                        <input type="text" class="form-control" id="titleExcludeFilter" name="titleExcludeFilter" placeholder="E.g., .*CAM.*|.*TS.*">
                                        <small class="text-muted">Skip items whose title matches this regex pattern</small>
                                            </div>
                                        </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="minSizeFilter" class="form-label">Minimum Size (MB)</label>
                                        <input type="number" class="form-control" id="minSizeFilter" name="minSizeFilter" placeholder="E.g., 100">
                                        <small class="text-muted">Skip items smaller than this size</small>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="maxSizeFilter" class="form-label">Maximum Size (MB)</label>
                                        <input type="number" class="form-control" id="maxSizeFilter" name="maxSizeFilter" placeholder="E.g., 5000">
                                        <small class="text-muted">Skip items larger than this size</small>
                                    </div>
                                        </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="minSeedersFilter" class="form-label">Minimum Seeders</label>
                                        <input type="number" class="form-control" id="minSeedersFilter" name="minSeedersFilter" placeholder="E.g., 5">
                                        <small class="text-muted">Skip items with fewer seeders</small>
                                        </div>
                                    <div class="col-md-6">
                                        <label for="categoryFilter" class="form-label">Category Filter</label>
                                        <input type="text" class="form-control" id="categoryFilter" name="categoryFilter" placeholder="E.g., 5000,5030,5040">
                                        <small class="text-muted">Comma-separated list of allowed categories</small>
                                    </div>
                                </div>


                            </div>

                            <!-- Catalog Configuration - Simplified -->
                            <div class="form-section">
                                <h6 class="mb-3">Catalog & Feed Configuration</h6>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="feedSource" class="form-label">Source Name</label>
                                        <input type="text" class="form-control" id="feedSource" name="feedSource" placeholder="E.g., RARBG, YTS, EZTV">
                                        <small class="text-muted">Name of the source providing the content</small>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="torrentType" class="form-label">Torrent Type</label>
                                        <select class="form-select" id="torrentType" name="torrentType">
                                            <option value="public">Public Tracker</option>
                                            <option value="private">Private Tracker</option>
                                            <option value="webseed">Web Seed</option>
                                        </select>
                                        <small class="text-muted">Type of torrent distribution</small>
                                    </div>
                                </div>

                                <!-- Catalog Detection Section -->
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <label class="form-label">Catalog Assignment</label>
                                        <div class="alert alert-info mb-3">
                                            <i class="bi bi-info-circle-fill me-2"></i>
                                            <strong>Smart Catalog Detection:</strong> Enable intelligent content analysis to automatically assign appropriate catalogs based on content patterns and metadata.
                                        </div>

                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="autoDetectCatalog" name="autoDetectCatalog">
                                            <label class="form-check-label" for="autoDetectCatalog">
                                                <strong>Enable Catalog Detection</strong>
                                                <small class="d-block text-muted">Automatically assign catalogs based on content analysis</small>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12">

                        <div class="mt-3" id="catalogPatternContainer" style="display: none;">
                            <div class="alert alert-success mb-3">
                                <i class="bi bi-check-circle-fill me-2"></i>
                                <strong>Detection Methods Available:</strong>
                                <ul class="mb-0 mt-2">
                                    <li><strong>Custom Patterns:</strong> Define specific regex patterns for precise catalog assignment</li>
                                    <li><strong>Smart Detection:</strong> Built-in analysis for sports, series, and movie content</li>
                                    <li><strong>Fallback Assignment:</strong> General catalogs for unmatched content</li>
                                </ul>
                            </div>

                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div>
                                    <h6 class="mb-0">Custom Catalog Patterns</h6>
                                    <small class="text-muted">Optional: Define specific patterns to override default detection</small>
                                </div>
                                <button type="button" class="btn btn-sm btn-primary" id="addCatalogPatternBtn">
                                    <i class="bi bi-plus-circle me-1"></i> Add Pattern
                                </button>
                            </div>

                            <div id="catalogPatternsContainer">
                                <!-- Catalog patterns will be added here dynamically -->
                            </div>

                            <div class="alert alert-light mt-3" id="noCatalogPatternsMessage">
                                <i class="bi bi-info-circle me-2"></i>
                                <strong>No custom patterns defined.</strong> The system will use built-in smart detection for sports, series, and movies. Add custom patterns above for more precise control.
                            </div>

                            <div class="alert alert-warning mt-3">
                                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                <strong>Pattern Priority:</strong> Custom patterns are checked first. If no custom patterns match, the system falls back to built-in detection algorithms.
                            </div>
                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-outline-secondary" id="cancelEditBtn" style="display: none;" onclick="resetForm()">
                                    Cancel
                                </button>
                                <button type="submit" class="btn btn-primary" id="submitBtn">Add Feed</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- RSS Feeds Table -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">RSS Feeds</h5>
                        <div>
                            <button type="button" class="btn btn-outline-secondary btn-sm me-2" id="logoutBtn">
                                <i class="bi bi-box-arrow-right me-1"></i> Logout
                            </button>
                            <button type="button" class="btn btn-primary btn-sm" id="runRssScraper">
                                <i class="bi bi-arrow-repeat me-1"></i> Run Scraper
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Bulk Actions -->
                        <div class="actions-bar mb-3">
                            <div class="row g-2 align-items-center">
                                <div class="col-auto">
                                    <h6 class="mb-0">Bulk Actions:</h6>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select form-select-sm" id="bulkActionSelect">
                                        <option value="">Select action...</option>
                                        <option value="activate">Activate Selected</option>
                                        <option value="deactivate">Deactivate Selected</option>
                                        <option value="delete">Delete Selected</option>
                                    </select>
                                </div>
                                <div class="col-auto">
                                    <button type="button" class="btn btn-sm btn-secondary" id="bulkActionBtn">Apply</button>
                                </div>
                                <div class="col-auto ms-auto">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="selectAllCheckbox">
                                        <label class="form-check-label" for="selectAllCheckbox">
                                            Select All
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Table -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>Name</th>
                                        <th>Status</th>
                                        <th>Last Scraped</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="rssFeedsTableBody">
                                    <!-- RSS feeds will be loaded here -->
                                    <tr>
                                        <td colspan="5" class="text-center py-4">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2">Loading RSS feeds...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Add Regex Test Modal -->
    <div class="modal fade" id="regexTestModal" tabindex="-1" aria-labelledby="regexTestModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="regexTestModalLabel">Test Regex Pattern</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="regexSourceContent" class="form-label">Source Content</label>
                        <textarea class="form-control" id="regexSourceContent" rows="5" readonly></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="regexPattern" class="form-label">Regex Pattern</label>
                        <input type="text" class="form-control" id="regexPattern">
                    </div>
                    <div class="mb-3">
                        <label for="regexGroup" class="form-label">Capture Group</label>
                        <input type="number" class="form-control" id="regexGroup" value="1" min="0">
                        <small class="text-muted">Use 0 for the entire match, 1 for the first group, etc.</small>
                    </div>
                    <button type="button" class="btn btn-primary" id="testRegexBtn">Test Pattern</button>
                    <div class="mt-3" id="regexTestResult" style="display: none;">
                        <div class="alert alert-info">
                            <h6>Result:</h6>
                            <p id="regexMatchResult"></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="applyRegexBtn">Apply Pattern</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Template for catalog pattern items -->
    <template id="catalogPatternTemplate">
        <div class="catalog-pattern-item card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="mb-0">Catalog Pattern</h6>
                    <button type="button" class="btn btn-sm btn-outline-danger remove-catalog-pattern-btn">
                        <i class="bi bi-trash"></i> Remove
                    </button>
                </div>

                <div class="row mb-3">
                    <div class="col-md-12">
                        <label class="form-label">Pattern Name</label>
                        <input type="text" class="form-control catalog-pattern-name" placeholder="E.g., Formula 1 Content, Tamil Movies, etc.">
                        <small class="text-muted">Descriptive name for this pattern</small>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-12">
                        <label class="form-label">Regex Pattern</label>
                        <div class="input-group">
                            <input type="text" class="form-control catalog-pattern-regex" placeholder="E.g., (?i)(formula.?1|f1), (?i)(tamil), (?i)(1080p|720p)">
                            <button class="btn btn-outline-secondary catalog-pattern-test-btn" type="button">
                                <i class="bi bi-eyeglasses"></i> Test
                            </button>
                        </div>
                        <small class="text-muted">Regex pattern to match against title, description, and category</small>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-md-12">
                        <label class="form-label">Target Catalogs</label>
                        <div class="catalog-checkboxes-container border rounded p-2" style="max-height: 200px; overflow-y: auto;">
                            <!-- Catalog checkboxes will be populated here -->
                        </div>
                        <small class="text-muted">Select which catalogs this pattern should assign content to</small>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input catalog-pattern-case-sensitive" type="checkbox" value="">
                            <label class="form-check-label">Case Sensitive</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check">
                            <input class="form-check-input catalog-pattern-enabled" type="checkbox" value="" checked>
                            <label class="form-check-label">Enabled</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Add a template for custom pattern items (hidden) -->
    <template id="customPatternTemplate">
        <div class="custom-pattern-item card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="mb-0">Custom Pattern</h6>
                    <button type="button" class="btn btn-sm btn-outline-danger remove-pattern-btn">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Field Name</label>
                        <input type="text" class="form-control custom-field-name" placeholder="E.g., resolution, quality">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Field Path</label>
                        <input type="text" class="form-control custom-field-path" placeholder="E.g., category or title">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <label class="form-label">Regex Pattern (optional)</label>
                        <div class="input-group">
                            <input type="text" class="form-control custom-field-regex" placeholder="E.g., (\d+p)">
                            <button class="btn btn-outline-secondary custom-regex-test-btn" type="button">
                                <i class="bi bi-eyeglasses"></i>
                            </button>
                        </div>
                        <small class="text-muted">Leave empty to use the path directly</small>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- JS Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
    <script src="/static/js/rssManager.js"></script>
</body>

</html>
